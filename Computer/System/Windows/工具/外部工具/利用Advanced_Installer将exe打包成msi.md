# 利用Advanced Installer将exe打包成msi

Advanced Installer下载链接：（适用win7 sp1 和win10 1903）

根据批量或者单一exe的文件数量不同，有不同方法。本文主要描述单一exe的封装方法。

根据exe里面数据文件不同，主要分成两种封装模式，主要区别是是否经过注册表
第一种打包安装，将注册表、快捷方式、文件夹等其他文件由安装前拍摄系统快照与安装之后拍摄系统快照进行对比，有增加的内容会采集到新的msi文件里。
第二种，是不经过注册表，俗称绿色版/免安装版本。通过创建msi的方法来生成msi

可能需要的工具：数字签名工具(安装visual stdio 2017即可拥有)
注意：win10在打包过程中也会有弹错，但无关紧要，不影响结果。

第一种，经过注册表的exe封装方法

一、导入exe
1.1 选择重新打包安装 和 语言（chinese simplified PRC）
1.2 点击 创建项目

(img)



1.3  一直点击 下一步 ，直到进入 程序包信息 界面
1.4 在 安装路径 一栏 选择需要重新安装的exe
产品名称、版本、公司名称会影响到控制面板中添加/删除程序的名称内容，后期也能手动再改
而且最好不是中文，否则会被处理成空格
若显示Product，表示未从exe从读取到内容。
第二个多选框是必要的
其他几个几乎没什么卵用，若是静默安装，后期有选项，轮不到目前来选择。
(img)




1.5 选择 配置文件输出文件夹 。后续如果要修改如何生成msi，直接打开本文件夹即可，无需重新执行 重新打包 步骤
1.6 使用过程监视器，使用过程监视器，使用过程监视器
(img)




1.7 进入 检查机器状态 界面，这个会列出诸如正在运行的程序、服务等内容
按自身需求去选择，如果只想完成exe的重封装，那么直接下一步即可
(img)




1.8 在安装之前 可以先确保系统环境没有什么变动过，或者说运行的应用软件越好越好。如没有问题，点击确定 开始重新包装过程
(img)





1.9 之后会捕捉系统状态，并保存系统快照，然后开始安装程序。
如果要msi静默安装到固定文件夹下，请在安装软件时选择期望的安装文件夹
部分软件是要依赖其他软件的，可以在 安装完文件夹时让您选择是否继续之前 先安装其他环境依赖，比如破解软件什么的
还要注意的是，在捕捉系统状态时，鼠标键盘什么的能不动就不动，
因为根据作者的经验，即使在文本文档里输入了什么，这个txt会被增加到msi里，包括搜狗拼音的xx内容都被加入到注册表了
以打开exe安装程序作为开始，以exe进程结束作为下一步，但部分软件并不遵从这条。总之，软件安装完之后再下一步。
安装图片不给出了。

1.10 选择 将捕获结果导入到新的 Advannced Installer 项目 ,点击 完成 按钮
为的就是自定义msi内容

二、自定义msi
2.1 点击 import 按钮，来导入exe文件里获得的资源
2.2  接下来笔者就描述一些设置，不详细描述了，主要有
更改添加/删除程序（appwiz.cpl）的图标、静默安装方法、重定义文件 、执行msi文件权力

2.3.1 更改添加/删除程序的图标
对默认设置的msi安装，在appwiz.cpl中只有默认的标志，无法通过图形特征区别软件。

2.3.1.1 依次点击左侧的 产品信息 - 产品细节  。再点击右侧的 控制面板图标 
任何带有图标的文件都可以被选择，除了向日葵软件
(img)




2.3.1.2 重定义文件，依次选择 资源 - 文件和文件夹 

其中蓝色表示没有文件资源，黑色字体表示有文件资源
其中需要注意的是，对 应用程序快捷方式文件夹 中文件，最好能重新创建一次，否则该文件经常会指向msi安装包。
如果桌面没有快捷方式，也可在 目标计算机 - 桌面 点击右键来增加快捷方式
对于某些恶意程序，也可以从里删除，当然部分软件依赖于注册表，需要先删除注册表，才能删除文件（该软件你会提醒你，转到定义再删除即可）。
(img)
(img)



2.3.1.2 